function random(a,b){return Math.random()*(b-a)+a}function calculateDistance(a,b,c,d){var e=a-c,f=b-d;return Math.sqrt(Math.pow(e,2)+Math.pow(f,2))}function Firework(a,b,c,d){for(this.x=a,this.y=b,this.sx=a,this.sy=b,this.tx=c,this.ty=d,this.distanceToTarget=calculateDistance(a,b,c,d),this.distanceTraveled=0,this.coordinates=[],this.coordinateCount=3;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=Math.atan2(d-b,c-a),this.speed=2,this.acceleration=1.05,this.brightness=random(50,70),this.targetRadius=1}function Particle(a,b){for(this.x=a,this.y=b,this.coordinates=[],this.coordinateCount=5;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=random(0,2*Math.PI),this.speed=random(1,10),this.friction=.95,this.gravity=1,this.hue=random(hue-20,hue+20),this.brightness=random(50,80),this.alpha=1,this.decay=random(.015,.03)}function createParticles(a,b){for(var c=30;c--;)particles.push(new Particle(a,b))}function loop(){requestAnimFrame(loop),hue+=.5,ctx.globalCompositeOperation="destination-out",ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,cw,ch),ctx.globalCompositeOperation="lighter";for(var a=fireworks.length;a--;)fireworks[a].draw(),fireworks[a].update(a);for(var a=particles.length;a--;)particles[a].draw(),particles[a].update(a);timerTick>=timerTotal?mousedown||(fireworks.push(new Firework(cw/2,ch,random(0,cw),random(0,ch/2))),timerTick=0):timerTick++,limiterTick>=limiterTotal?mousedown&&(fireworks.push(new Firework(cw/2,ch,mx,my)),limiterTick=0):limiterTick++}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),cw=window.innerWidth,ch=window.innerHeight,fireworks=[],particles=[],hue=120,limiterTotal=5,limiterTick=0,timerTotal=80,timerTick=0,mousedown=!1,mx,my;canvas.width=cw,canvas.height=ch,Firework.prototype.update=function(a){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.targetRadius<8?this.targetRadius+=.3:this.targetRadius=1,this.speed*=this.acceleration;var b=Math.cos(this.angle)*this.speed,c=Math.sin(this.angle)*this.speed;this.distanceTraveled=calculateDistance(this.sx,this.sy,this.x+b,this.y+c),this.distanceTraveled>=this.distanceToTarget?(createParticles(this.tx,this.ty),fireworks.splice(a,1)):(this.x+=b,this.y+=c)},Firework.prototype.draw=function(){ctx.beginPath(),ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),ctx.lineTo(this.x,this.y),ctx.strokeStyle="hsl("+hue+", 100%, "+this.brightness+"%)",ctx.stroke(),ctx.beginPath(),ctx.arc(this.tx,this.ty,this.targetRadius,0,2*Math.PI),ctx.stroke()},Particle.prototype.update=function(a){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&particles.splice(a,1)},Particle.prototype.draw=function(){ctx.beginPath(),ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),ctx.lineTo(this.x,this.y),ctx.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+this.alpha+")",ctx.stroke()},canvas.addEventListener("mousemove",function(a){mx=a.pageX-canvas.offsetLeft,my=a.pageY-canvas.offsetTop}),canvas.addEventListener("mousedown",function(a){a.preventDefault(),mousedown=!0}),canvas.addEventListener("mouseup",function(a){a.preventDefault(),mousedown=!1}),window.onload=loop;